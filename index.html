<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anglies Pėdsako Skaičiuoklė</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<script src="https://kit.fontawesome.com/2d6d331929.js" crossorigin="anonymous"></script>
<script type="module" >
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js"
    import { getDatabase, ref, set, child, get } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js"
    
    const firebaseConfig = {
      apiKey: "AIzaSyBCpnGUngrZB6OMU1Fyig7owONHWrTCHtk",
      authDomain: "projektas-co2-pedsakas.firebaseapp.com",
      databaseURL: "https://projektas-co2-pedsakas-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "projektas-co2-pedsakas",
      storageBucket: "projektas-co2-pedsakas.appspot.com",
      messagingSenderId: "927191635694",
      appId: "1:927191635694:web:ad755fe58c4817132f85ff",
      measurementId: "G-6KM350E27H"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase();
    function writeData(userId, Class, Emission) {
    set(ref(db, 'users/' + userId), {
        class: Class,
        emission: Emission
    });
    }

    function readData(collection,id) {
        const dbRef = ref(getDatabase());
        get(child(dbRef, `${collection}/${id}`)).then((snapshot) => {
        if (snapshot.exists()) {
            return snapshot.val();
        } else {
            return null;
        }
        }).catch((error) => {
        console.error(error);
        });
    }

    function makeid(length) {
        let result = '';
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        const charactersLength = characters.length;
        let counter = 0;
        while (counter < length) {
        result += characters.charAt(Math.floor(Math.random() * charactersLength));
        counter += 1;
        }
        return result;
    }
    
    document.addEventListener("DOMContentLoaded", function() {
    const questions = document.querySelectorAll('.question');
    const totalQuestions = questions.length;
    let currentQuestion = 0;
    let totalscore = 0;
    let submit = false;

    function showQuestion(index) {
        questions.forEach((question, i) => {
            if (i === index) {
                question.style.display = "block";
            } else {
                question.style.display = "none";
            }
        });
    }

    function nextQuestion() {
        currentQuestion++;
        if (currentQuestion < totalQuestions) {
            showQuestion(currentQuestion);
        } else {
            showResults();
        }
    }   

    function showResults() {
        let totalscore = 0;
        const radioButtons = document.querySelectorAll('input[type="radio"]:checked');
        radioButtons.forEach((radioButton) => {
            totalscore += Number(radioButton.value);
        });
        const checkButtons = document.querySelectorAll('input[type="checkbox"]:checked');
        checkButtons.forEach((checkButton) => {
            totalscore += Number(checkButton.value);
        });
        const sliders = document.querySelectorAll('input[type="range"]');
        sliders.forEach((slider) => {
            totalscore += Number(slider.value)*Number(slider.dataset.mult);
        });
    
        let response = "";
        let response_color = "000000";
        console.log(totalscore,"tons")

        if (submit===false) {
            writeData(makeid(5),'any',totalscore)
            submit = true;
        }
    
        if (totalscore < 1500) {
            response = "Tikras klimato aktyvistas!";
            response_color = "#14b373";
        } else if (totalscore < 4600) {
            response = "Šaunuolis, tavo Co2 emisija yra mažesnė už vidutinio žmogaus";
            response_color = "#4cb314";
        } else if (totalscore < 5000) {
            response = "Tavo Co2 emisija yra tokia pat kaip vidutinio žmogaus";
            response_color = "#b0b017";
        } else {
            response = "Tavo Co2 emisija yra labai didelė lyginant su vidutiniu žmogumi";
            response_color = "#a83116";
        }

    
        const modal = document.getElementById('resultsModal');
        const sourcesDiv = document.getElementById('sourcediv');
        const resultheading = document.getElementById("resultheading");
        const resulttext = document.getElementById('results');
        const footprinttext = document.getElementById('footprint');
        resultheading.innerHTML = "Rezultatai"
        resulttext.innerHTML = response;
        footprinttext.innerHTML = `~${totalscore} tonų anglies dioksido`
        resulttext.style.color = response_color;
        footprinttext.style.color = response_color;
        modal.style.display = "block";
        const closeButton = document.getElementsByClassName("closeButton")[0];

        while(sourcesDiv.firstChild) { 
            sourcesDiv.removeChild(sourcesDiv.firstChild); 
        } 

        closeButton.onclick = function() {
            modal.style.display = "none";
        }
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
                totalscore=0;
            }
        }
    }
    

    // Attach event listeners to all "Next" buttons
    for (let i = 1; i <= totalQuestions; i++) {
        document.getElementById(`nextButton${i}`).addEventListener('click', nextQuestion);
    }

    // Show the first question initially
    showQuestion(currentQuestion);

    let sourceopen = false;
    function showSources() {
        const resultheading = document.getElementById("resultheading");
        const resulttext = document.getElementById('results');
        const footprinttext = document.getElementById('footprint');
        const sourceDiv = document.getElementById('sourcediv');
        resultheading.innerHTML = "Šaltiniai"
        resulttext.innerHTML = ''
        footprinttext.innerHTML = ''
        var link1 = document.createElement("a");
        link1.href = "https://www.carbonfootprint.com/energyconsumption.html"; link1.innerHTML = "Namų prietaisų Co2 pėdsako lentelė <br>"
        var link2 = document.createElement("a");
        link2.href = "https://skoot.eco/articles/carbon-footprint-of-everyday-things"; link2.innerHTML = "Kasdienybės Co2 pėdskas, straipsnis <br>"
        var link3 = document.createElement("a");
        link3.href = "https://createfashionbrand.com/carbon-footprint/"; link3.innerHTML = "Tekstilės Co2 pėdskas, straipsnis <br>"
        var link4 = document.createElement("a");
        link4.href = "https://www.worldometers.info/co2-emissions/co2-emissions-by-country/"; link4.innerHTML = "Planetos Co2 emisijų statistika <br>"
        sourceDiv.appendChild(link1);
        sourceDiv.appendChild(link2);
        sourceDiv.appendChild(link3);
        sourceDiv.appendChild(link4);
    };

    const sourcesbutton = document.getElementById('sources')
    sourcesbutton.addEventListener('click', () => {
        if (!sourceopen){
            showSources();
            sourceopen = true;
        } else{
            showResults();
            sourceopen = false;
        }
        
    })
    });

    function updateSliderValue(slider, slidervalue) {
        slider.addEventListener('input', function() {
            slidervalue.innerHTML = slider.value;
        });
    }
    const slider7 = document.getElementById("q7-slider");
    const slidervalue7 = document.getElementById("rangeIndicator7");
    updateSliderValue(slider7, slidervalue7);

    const slider1 = document.getElementById("q1-slider");
    const slidervalue1 = document.getElementById("rangeIndicator1");
    updateSliderValue(slider1, slidervalue1);

</script>
<body>
    <h1 id="caption">Anglies Pėdsako Skaičiuoklė</h1>
    <div id="questionnaire">
        <div class="question" id="question1">
            <h3>Kiek kartų per savaitę naudojate automobilį?</h3>
            <input id="q1-slider" type="range" min="0" max="20" value="50" data-mult="1">
            <label id="rangeIndicator1" class="rangeIndicator">0</label><br>
            <button id="nextButton1">Toliau</button><br>
        </div>
        <div class="question" id="question2">
            <h3>Kiek dažnai vartojate mėsą arba pieno produktus (Kaip pagrindinį patiekalą)?</h3>
            <input type="radio" name="meatDairyConsumption" value="3600"> Kasdien kelis kartus<br>
            <input type="radio" name="meatDairyConsumption" value="1800"> Kasdien<br>
            <input type="radio" name="meatDairyConsumption" value="800"> Keletą kartų per savaitę<br>
            <button id="nextButton2">Toliau</button><br>
        </div>
        <div class="question" id="question3">
            <h3>Kokiu būdu keliaujate ilgus atstumus (500 km)?</h3>
            <input type="radio" name="travelChoice" value="90"> Automobilis<br>
            <input type="radio" name="travelChoice" value="75"> Lėktuvas<br>
            <input type="radio" name="travelChoice" value="50"> Autobusas<br>
            <input type="radio" name="travelChoice" value="20"> Traukinys<br>
            <button id="nextButton3">Toliau</button><br>
        </div>
        <div class="question" id="question4">
            <h3>Kiek kartų per savaitę valgote vaisių ar daržovių iš tolimų šalių?</h3>
            <input type="radio" name="importedFoodConsumption" value="3000"> Kasdien<br>
            <input type="radio" name="importedFoodConsumption" value="1200"> Keletą kartų per savaitę<br>
            <input type="radio" name="importedFoodConsumption" value="400"> Retkarčiais ar niekada<br>
            <button id="nextButton4">Toliau</button><br>
        </div>
        <div class="question" id="question5">
            <h3>Kokie buities įrenginiai yra pas jus namie?</h3><br>
            <input type="checkbox" value="40">Mikrobangų krosnelė<br>
            <input type="checkbox" value="50">Skalbimo mašina<br>
            <input type="checkbox" value="160">Džiovinimo mašina<br>
            <input type="checkbox" value="70">Virdulys<br>
            <input type="checkbox" value="60">Orkaitė<br>
            <input type="checkbox" value="110">Kaitlentė<br>
            <input type="checkbox" value="85">Indaplovė<br>
            <input type="checkbox" value="120">Šaldytuvas<br>
            <button id="nextButton5">Toliau</button><br>
        </div>
        
        <div class="question" id="question6">
            <h3>Kokiu būdu šildote namus?</h3>
            <input type="radio" name="homeHeating" value="1200"> Centrinis šildymas<br>
            <input type="radio" name="homeHeating" value="1000"> Durpės ar mediena<br>
            <input type="radio" name="homeHeating" value="3500"> Dujos<br>
            <input type="radio" name="homeHeating" value="2700"> Elektra<br>
            <button id="nextButton6">Toliau</button><br>
        </div>
        <div class="question" id="question7">
            <h3>Kiek per metus jūs perkate naujus rūbus?</h3>
            <input type="range" id="q7-slider" min="0" max="20" name="clothes" value="50" data-mult="7">
            <label id="rangeIndicator7" class="rangeIndicator">0</label><br>
            <button id="nextButton7">Toliau</button><br>
        </div>
        

        <div id="resultsModal" class="modal">
            <div class="modal-content">
                <span class="closeButton">&times;</span>
                <h1 id="resultheading">Rezultatai</h2>
                <div id="sourcediv"></div>
                <div id="resultsContent">
                    <h2 id="results">Rezultatai</h2>
                    <h4 id="footprint">pėdsakas</h4>
                    <i class="fa-solid fa-file fa-2xl" style="color: #649635;" id="sources"></i>
                </div>
            </div>
        </div>
    </div>

    <!--<script src="script.js"></script>-->
</body>
</html>
